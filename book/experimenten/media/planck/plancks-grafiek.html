<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>LED Drempelspanning Analyse</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: center; }
    th { background-color: #f0f0f0; }
    input { width: 80px; }
    #trendline { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>LED Drempelspanning → Energie vs Frequentie</h2>
  <p>Vul de drempelspanning (V) in voor de leds, de rest wordt automatisch berekend.</p>

  <table id="ledTable">
    <thead>
      <tr>
        <th>Kleur</th>
        <th>Golflengte (nm)</th>
        <th>Drempelspanning (V)</th>
        <th>Frequentie (Hz)</th>
        <th>qU (J)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>IR</td><td>940</td><td><input type="number" step="0.01"></td><td></td><td></td></tr>
      <tr><td>Rood</td><td>630</td><td><input type="number" step="0.01"></td><td></td><td></td></tr>
      <tr><td>Geel</td><td>590</td><td><input type="number" step="0.01"></td><td></td><td></td></tr>
      <tr><td>Groen</td><td>580</td><td><input type="number" step="0.01"></td><td></td><td></td></tr>
      <tr><td>Blauw</td><td>458</td><td><input type="number" step="0.01"></td><td></td><td></td></tr>
      <tr><td>UV</td><td>368</td><td><input type="number" step="0.01"></td><td></td><td></td></tr>
    </tbody>
  </table>

  <canvas id="myChart" width="700" height="400"></canvas>
  <div id="trendline"></div>

  <script>
    const c = 3e8;        // lichtsnelheid (m/s)
    const q = 1.602e-19;  // elementaire lading (C)
    const table = document.getElementById("ledTable").getElementsByTagName("tbody")[0];
    const ctx = document.getElementById("myChart").getContext("2d");

    let chart = new Chart(ctx, {
      type: "scatter",
      data: { datasets: [{
        label: "LED data",
        data: [],
        backgroundColor: "blue"
      },{
        label: "Lineaire fit",
        data: [],
        type: "line",
        borderColor: "red",
        fill: false,
        pointRadius: 0
      }]},
      options: {
        scales: {
          x: { title: { display: true, text: "Frequentie (Hz)" }},
          y: { title: { display: true, text: "qU (J)" }}
        }
      }
    });

    function update() {
      let xs = [], ys = [];
      [...table.rows].forEach(row => {
        let lambda = parseFloat(row.cells[1].textContent) * 1e-9;
        let V = parseFloat(row.cells[2].firstChild.value);
        let f = c / lambda;
        let qU = (isNaN(V) ? NaN : q * V);

        row.cells[3].textContent = f.toExponential(3);
        row.cells[4].textContent = isNaN(qU) ? "" : qU.toExponential(3);

        if (!isNaN(qU)) {
          xs.push(f);
          ys.push(qU);
        }
      });

      // Lineaire fit door de oorsprong: slope = Σ(xy)/Σ(x²)
      let slope = (xs.reduce((s, x, i) => s + x*ys[i], 0)) /
                  (xs.reduce((s, x) => s + x*x, 0));

      let fitData = [];
      if (xs.length > 1) {
        let minX = Math.min(...xs), maxX = Math.max(...xs);
        fitData = [{x:minX, y:slope*minX}, {x:maxX, y:slope*maxX}];
      }

      chart.data.datasets[0].data = xs.map((x,i) => ({x:x, y:ys[i]}));
      chart.data.datasets[1].data = fitData;
      chart.update();

      // Planck-constante uit de fit
      let h = slope; // want qU = h f
      let h_eVs = h / q; // omzetten naar eV·s

      document.getElementById("trendline").innerHTML =
        xs.length>1
          ? `Fit: qU = (${slope.toExponential(3)})·f <br>
             ⇒ h ≈ ${h.toExponential(3)} J·s 
             (${h_eVs.toExponential(3)} eV·s)`
          : "";
    }

    // Event listeners
    [...table.querySelectorAll("input")].forEach(inp => inp.addEventListener("input", update));
  </script>
</body>
</html>
